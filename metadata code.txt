import com.drew.imaging.ImageMetadataReader;
import com.drew.metadata.Metadata;
import com.drew.metadata.exif.ExifIFD0Directory;
import com.drew.metadata.exif.ExifSubIfdDirectory;
import com.drew.metadata.Tag;
import com.drew.metadata.jpeg.JpegDirectory;
import com.drew.metadata.jpeg.JpegImageMetadata;

import java.io.File;

public class ImageMetadataExtractor {

    public static void extractImageMetadata(String imagePath) throws Exception {
        // Load the image file
        File imageFile = new File(imagePath);
        String fileName = imageFile.getName();  // Extract file name
        long originalSize = imageFile.length(); // Get the original file size
        System.out.println("File Name: " + fileName);
        System.out.println("Original Size: " + originalSize + " bytes");

        // Extract metadata from the image
        Metadata metadata = ImageMetadataReader.readMetadata(imageFile);

        // Extract image dimensions (width and height)
        JpegImageMetadata jpegMetadata = (JpegImageMetadata) metadata.getFirstDirectoryOfType(JpegDirectory.class);
        int width = jpegMetadata.getImageWidth();
        int height = jpegMetadata.getImageHeight();
        System.out.println("Dimensions: " + width + "x" + height);

        // Extract EXIF metadata
        ExifIFD0Directory exifIFD0Directory = metadata.getFirstDirectoryOfType(ExifIFD0Directory.class);
        ExifSubIfdDirectory exifSubIfdDirectory = metadata.getFirstDirectoryOfType(ExifSubIfdDirectory.class);

        String flash = "Unknown";
        String device = "Unknown";

        if (exifIFD0Directory != null) {
            // Extract device (camera make and model)
            device = exifIFD0Directory.getString(ExifIFD0Directory.TAG_MAKE) + " " +
                    exifIFD0Directory.getString(ExifIFD0Directory.TAG_MODEL);

            // Check if flash was fired
            if (exifSubIfdDirectory != null) {
                int flashFlag = exifSubIfdDirectory.getInt(ExifSubIfdDirectory.TAG_FLASH);
                flash = (flashFlag == 0) ? "No Flash" : "Flash Fired";
            }
        }

        System.out.println("Device: " + device);
        System.out.println("Flash: " + flash);

        // You might want to handle the uploadedBy data manually, for instance:
        // This is typically tracked at the time of uploading the file (e.g., in your database)
        String uploadedBy = "user123";  // Example placeholder, should be dynamically set
        System.out.println("Uploaded By: " + uploadedBy);

        // Image name (can be extracted from file name)
        String imageName = fileName.split("\\.")[0];  // Strip the extension
        System.out.println("Image Name: " + imageName);
    }

    public static void main(String[] args) throws Exception {
        String imagePath = "path/to/your/image.jpg"; // Provide your image path here
        extractImageMetadata(imagePath);
    }
}
